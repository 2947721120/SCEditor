(function(a){a.sceditor=function(J,t){var o=this;var u=a(J);var i=J;var L=null;var h=null;var E=null;var v=null;var b=null;var n=null;var y=false;var w=[];var C=null;var p=null;var c=[];var F=null;var H,j,f,K,m,A,e,z,s,q,d,B,l,k,x,r,D,I,g,G;o.commands=a.sceditor.commands;H=function(){u.data("sceditor",o);o.options=a.extend({},a.sceditor.defaultOptions,t);if(o.options.locale!==null&&o.options.locale!=="en"){g()}if(o.options.height!==null){u.height(o.options.height)}if(o.options.width!==null){u.width(o.options.width)}if((o.options.height!==null&&o.options.height.toString().indexOf("%")>-1)||(o.options.width!==null&&o.options.width.toString().indexOf("%")>-1)){a(window).resize(r)}L=a('<div class="sceditor-container" />').width(u.outerWidth()).height(u.outerHeight());u.after(L);s();z();q();if(o.options.resizeEnabled){d()}a(document).click(B);u.parents("form").attr("novalidate","novalidate").submit(l);if(o.options.emoticonsRoot&&o.options.emoticons){a.each(o.options.emoticons,function(N,O){a.each(O,function(Q,P){o.options.emoticons[N][Q]=o.options.emoticonsRoot+P})})}var M=u.hide().val();if(o.options.getTextHandler){M=o.options.getTextHandler(M)}o.setWysiwygEditorValue(M);if(o.options.toolbar.indexOf("emoticon")!==-1){k()}};z=function(){var N=a('<div contenteditable="true">')[0].contentEditable,M=typeof N!=="undefined"&&N!=="inherit",O;b=a("<textarea></textarea>").hide();E=a('<iframe frameborder="0"></iframe>');if(window.location.protocol==="https:"){E.attr("src","javascript:false")}L.append(E).append(b);v=E[0];I(u.width());D(u.height());if(!M){x().designMode="On"}x().open();x().write('<html><head><!--[if gte IE 9]><style>* {min-height: auto !important}</style><![endif]--><meta http-equiv="Content-Type" content="text/html;charset='+o.options.charset+'" /><link rel="stylesheet" type="text/css" href="'+o.options.style+'" /></head><body contenteditable="true"></body></html>');x().close();if(!M){x().designMode="On"}O=a(x());O.find("body").keypress(m);O.find("body").keyup(A);O.keypress(m);O.keyup(A);O.mousedown(e);O.bind("beforedeactivate keyup",K);O.focus(function(){C=null});F=new a.sceditor.rangeHelper(v.contentWindow)};s=function(){var O=function(U){f(a(this),o.commands[a(this).data("sceditor-command")]);U.preventDefault()};h=a('<div class="sceditor-toolbar" />');var N=o.options.toolbar.split("|"),T,S,R,Q,P;for(P=0;P<N.length;P++){T=a('<div class="sceditor-group" />');S=N[P].split(",");for(var M=0;M<S.length;M++){if(!o.commands.hasOwnProperty(S[M])){continue}R=o.commands[S[M]].tooltip?o._(o.commands[S[M]].tooltip):S[M];Q=a('<a class="sceditor-button sceditor-button-'+S[M]+' " unselectable="on"><div unselectable="on">'+R+"</div></a>");if(o.commands[S[M]].hasOwnProperty("tooltip")){Q.attr("title",o._(o.commands[S[M]].tooltip))}if(o.commands[S[M]].exec){Q.data("sceditor-wysiwygmode",true)}else{Q.addClass("disabled")}if(o.commands[S[M]].txtExec){Q.data("sceditor-txtmode",true)}Q.data("sceditor-command",S[M]);Q.click(O);T.append(Q)}h.append(T)}if(o.options.toolbarContainer===null){L.append(h)}else{a(o.options.toolbarContainer).append(h)}};q=function(){a.each(o.commands,function(N,M){if(typeof M.keyPress!=="undefined"){w.push(M.keyPress)}})};I=function(M){L.width(M);E.width(M);E.width(M+(M-E.outerWidth(true)));b.width(M);b.width(M+(M-b.outerWidth(true)))};D=function(M){L.height(M);M=M-(o.options.toolbarContainer===null?h.outerHeight():0);E.height(M);E.height(M+(M-E.outerHeight(true)));b.height(M);b.height(M+(M-b.outerHeight(true)))};d=function(){var O=a('<div class="sceditor-grip" />'),Z=a('<div class="sceditor-resize-cover" />'),R=0,P=0,Q=0,X=0,W=L.width(),Y=L.height(),U=false,V,T,M,S,N;V=(o.options.resizeMinHeight==null?Y/2:o.options.resizeMinHeight);T=(o.options.resizeMaxHeight==null?Y*2:o.options.resizeMaxHeight);M=(o.options.resizeMinWidth==null?W/2:o.options.resizeMinWidth);S=(o.options.resizeMaxWidth==null?W*2:o.options.resizeMaxWidth);N=function(ac){var aa=X+(ac.pageY-P),ab=Q+(ac.pageX-R);if(ab>=M&&(S<0||ab<=S)){I(ab)}if(aa>=V&&(T<0||aa<=T)){D(aa)}ac.preventDefault()};L.append(O);L.append(Z.hide());O.mousedown(function(aa){R=aa.pageX;P=aa.pageY;Q=L.width();X=L.height();U=true;Z.show();a(document).bind("mousemove",N);aa.preventDefault()});a(document).mouseup(function(aa){if(!U){return}U=false;Z.hide();a(document).unbind("mousemove",N);aa.preventDefault()})};l=function(M){o.updateTextareaValue();a(this).removeAttr("novalidate");if(this.checkValidity&&!this.checkValidity()){M.preventDefault()}a(this).attr("novalidate","novalidate")};o.destory=function(){a(document).unbind("click",B);u.removeAttr("novalidate").unbind("submit",l);a(window).unbind("resize",r);L.remove();L=null;u.removeData("sceditor").show()};k=function(){var N=a.extend({},o.options.emoticons.more,o.options.emoticons.dropdown,o.options.emoticons.hidden),M;a.each(N,function(P,O){M=document.createElement("img");M.src=O;c.push(M)})};o.createDropDown=function(N,Q,P,O){o.closeDropDown();if(O!==false){P=a(P);P.find(":not(input,textarea)").filter(function(){return this.nodeType===1}).attr("unselectable","on")}var M={top:N.offset().top,left:N.offset().left};a.extend(M,o.options.dropDownCss);n=a('<div class="sceditor-dropdown sceditor-'+Q+'" />').css(M).append(P);n.appendTo(a("body"));y=true;n.click(function(R){R.stopPropagation()})};B=function(M){if(!y&&M.which!==3){o.closeDropDown()}y=false};o.closeDropDown=function(M){if(n!==null){n.remove();n=null}if(M===true){o.focus()}};x=function(){if(v.contentDocument){return v.contentDocument}if(v.contentWindow&&v.contentWindow.document){return v.contentWindow.document}if(v.document){return v.document}return null};o.wysiwygEditorInsertHtml=function(N,O,M){o.focus();if(!M&&(a(F.parentNode()).is("code")||a(F.parentNode()).parents("code").length!==0)){return}F.insertHTML(N,O)};o.wysiwygEditorInsertText=function(M){M=M.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />");o.wysiwygEditorInsertHtml(M)};o.getRangeHelper=function(){return F};o.getWysiwygEditorValue=function(N){var O=E.contents().find("body"),M;a.sceditor.dom.fixNesting(O.get(0));M=O.html();if(N!==false&&o.options.getHtmlHandler){M=o.options.getHtmlHandler(M,O)}return M};o.getTextareaValue=function(M){var N=b.val();if(M!==false&&o.options.getTextHandler){N=o.options.getTextHandler(N)}return N};o.setWysiwygEditorValue=function(M){x().body.innerHTML=j(M)};o.setTextareaValue=function(M){b.val(M)};o.updateTextareaValue=function(){if(G()){u.val(o.getTextareaValue(false))}else{u.val(o.getWysiwygEditorValue())}};j=function(M){var N=a.extend({},o.options.emoticons.more,o.options.emoticons.dropdown,o.options.emoticons.hidden);a.each(N,function(P,O){var Q=a.sceditor.regexEscape(P)+"(?=([^\\<\\>]*?<(?!/code)|[^\\<\\>]*?$))",R="";if(o.options.emoticonsCompat){Q="((>|^|\\s|\xA0|\u2002|\u2003|\u2009|&nbsp;))"+Q+"(?=(\\s|$|<|\xA0|\u2002|\u2003|\u2009|&nbsp;))";R="$1"}M=M.replace(new RegExp(Q,"gm"),R+'<img src="'+O+'" data-sceditor-emoticon="'+P+'" alt="'+P+'" />')});return M};G=function(){return b.is(":visible")};o.toggleTextMode=function(){if(G()){o.setWysiwygEditorValue(o.getTextareaValue())}else{o.setTextareaValue(o.getWysiwygEditorValue())}h.find(".sceditor-button").removeClass("disabled");C=null;b.toggle();E.toggle();h.find(".sceditor-button").each(function(){var M=a(this);if(G()&&!M.data("sceditor-txtmode")){M.addClass("disabled")}else{if(!G()&&!M.data("sceditor-wysiwygmode")){M.addClass("disabled")}}})};f=function(M,N){if(G()){if(N.hasOwnProperty("txtExec")){N.txtExec.call(o,M)}return}if(!N.hasOwnProperty("exec")){return}if(a.isFunction(N.exec)){N.exec.call(o,M)}else{o.execCommand(N.exec,N.hasOwnProperty("execParam")?N.execParam:null)}};o.focus=function(){v.contentWindow.focus();if(C!==null){F.selectRange(C);C=null}};K=function(){if(!a.browser.msie){return}C=F.selectedRange()};o.execCommand=function(P,O){var M=false;o.focus();if(a(F.parentNode()).is("code")||a(F.parentNode()).parents("code").length!==0){return}if(x()){try{M=x().execCommand(P,false,O)}catch(N){}}if(!M&&typeof o.commands[P]!=="undefined"&&typeof o.commands[P].errorMessage!=="undefined"){alert(o._(o.commands[P].errorMessage))}};m=function(O){o.closeDropDown();var Q=F.parentNode(),M=a(Q);if(O.which===13){if(M.is("code, blockquote")||M.parents("code, blockquote").length!==0){C=null;o.wysiwygEditorInsertHtml("<br />",null,true);return false}}var P=x();a.sceditor.dom.rTraverse(P.body,function(R){if((R.nodeType===3&&R.nodeValue!=="")||R.nodeName.toLowerCase()==="br"){if(a(R).parents("code, blockquote").length>0){a(P.body).append(P.createElement("br"))}return false}},true);if(M.is("code")||M.parents("code").length!==0){return}var N=w.length;while(N--){w[N].call(o,O,v,b)}};A=function(M){};e=function(M){o.closeDropDown();C=null};r=function(){if(o.options.height!==null&&o.options.height.toString().indexOf("%")>-1){D(L.parent().height()*(parseFloat(o.options.height)/100))}if(o.options.width!==null&&o.options.width.toString().indexOf("%")>-1){I(L.parent().width()*(parseFloat(o.options.width)/100))}};o._=function(){var M=arguments;if(p!==null&&p[M[0]]){M[0]=p[M[0]]}return M[0].replace(/\{(\d+)\}/g,function(O,N){return typeof M[N-0+1]!=="undefined"?M[N-0+1]:"{"+N+"}"})};g=function(){if(a.sceditor.locale[o.options.locale]){p=a.sceditor.locale[o.options.locale]}else{var M=o.options.locale.split("-");if(a.sceditor.locale[M[0]]){p=a.sceditor.locale[M[0]]}}if(p!==null&&p.dateFormat){o.options.dateFormat=p.dateFormat}};H()};a.sceditor.ie=(function(){var d,b=3,e=document.createElement("div"),c=e.getElementsByTagName("i");while(e.innerHTML="<!--[if gt IE "+(++b)+"]><i></i><![endif]-->",c[0]){}return b>4?b:d}());a.sceditor.regexEscape=function(b){return b.replace(/[\$\?\[\]\.\*\(\)\|]/g,"\\$&").replace("<","&lt;").replace(">","&gt;")};a.sceditor.locale={};a.sceditor.commands={bold:{exec:"bold",tooltip:"Bold"},italic:{exec:"italic",tooltip:"Italic"},underline:{exec:"underline",tooltip:"Underline"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{exec:function(c){var e=this,g=e.options.fonts.split(","),f=a("<div />"),b=function(h){e.execCommand("fontname",a(this).data("sceditor-font"));e.closeDropDown(true);h.preventDefault()};for(var d=0;d<g.length;d++){f.append(a('<a class="sceditor-font-option" href="#"><font face="'+g[d]+'">'+g[d]+"</font></a>").data("sceditor-font",g[d]).click(b))}e.createDropDown(c,"font-picker",f)},tooltip:"Font Name"},size:{exec:function(c){var e=this,f=a("<div />"),b=function(g){e.execCommand("fontsize",a(this).data("sceditor-fontsize"));e.closeDropDown(true);g.preventDefault()};for(var d=1;d<=7;d++){f.append(a('<a class="sceditor-fontsize-option" href="#"><font size="'+d+'">'+d+"</font></a>").data("sceditor-fontsize",d).click(b))}e.createDropDown(c,"fontsize-picker",f)},tooltip:"Font Size"},color:{exec:function(d){var j=this,c={r:255,g:255,b:255},k=a("<div />"),g=this.options.colors?this.options.colors.split("|"):new Array(21),h=[],m=0;for(var f=0;f<g.length;++f){var b=(typeof g[f]!=="undefined")?g[f].split(","):new Array(21);h[m++]='<div class="sceditor-color-column">';for(var l=0;l<b.length;++l){var e=(typeof b[l]!=="undefined")?b[l]:"#"+c.r.toString(16)+c.g.toString(16)+c.b.toString(16);h[m++]='<a href="#" class="sceditor-color-option" style="background-color: '+e+'" data-color="'+e+'"></a>';if(l%5===0){c={r:c.r,g:c.g-51,b:255}}else{c={r:c.r,g:c.g,b:c.b-51}}}h[m++]="</div>";if(f%5===0){c={r:c.r-51,g:255,b:255}}else{c={r:c.r,g:255,b:255}}}k.append(h.join("")).find("a").click(function(i){j.execCommand("forecolor",a(this).attr("data-color"));j.closeDropDown(true);i.preventDefault()});j.createDropDown(d,"color-picker",k)},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(b){var c=this,d=a(this._('<form><div><label for="txt">{0}</label> <textarea cols="20" rows="7" id="txt"></textarea></div></form>',this._("Paste your text inside the following box:"))).submit(function(){return false});d.append(a(this._('<div><input type="button" class="button" value="{0}" /></div>',this._("Insert"))).click(function(f){c.wysiwygEditorInsertText(a(this).parent("form").find("#txt").val());c.closeDropDown(true);f.preventDefault()}));c.createDropDown(b,"pastetext",d)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{exec:"insertorderedlist",tooltip:"Numbered list"},table:{exec:function(b){var c=this,d=a(this._('<form><div><label for="rows">{0}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{1}</label><input type="text" id="cols" value="2" /></div></form>',this._("Rows:"),this._("Cols:"))).submit(function(){return false});d.append(a(this._('<div><input type="button" class="button" value="{0}" /></div>',this._("Insert"))).click(function(j){var h=a(this).parent("form").find("#rows").val()-0,i=a(this).parent("form").find("#cols").val()-0,g="<table>";if(h<1||i<1){return}for(var k=0;k<h;k++){g+="<tr>";for(var f=0;f<i;f++){if(a.browser.msie){g+="<td></td>"}else{g+='<td><br class="sceditor-ignore" /></td>'}}g+="</tr>"}g+="</table>";c.wysiwygEditorInsertHtml(g);c.closeDropDown(true);j.preventDefault()}));c.createDropDown(b,"inserttable",d)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{exec:function(){this.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{exec:function(b){var c=this,d=a(this._('<form><div><label for="link">{0}</label> <input type="text" id="image" value="http://" /></div><div><label for="width">{1}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{2}</label> <input type="text" id="height" size="2" /></div></form>',this._("URL:"),this._("Width (optional):"),this._("Height (optional):"))).submit(function(){return false});d.append(a(this._('<div><input type="button" class="button" value="Insert" /></div>',this._("Insert"))).click(function(j){var g=a(this).parent("form"),k=g.find("#image").val(),h="",i,f;if((i=g.find("#width").val())){h+=' width="'+i+'"'}if((f=g.find("#height").val())){h+=' height="'+f+'"'}if(k&&k!=="http://"){c.wysiwygEditorInsertHtml("<img"+h+' src="'+k+'" />')}c.closeDropDown(true);j.preventDefault()}));c.createDropDown(b,"insertimage",d)},tooltip:"Insert an image"},email:{exec:function(b){var c=this,d=a(this._('<form><div><label for="email">{0}</label> <input type="text" id="email" value="" /></div></form>',this._("E-mail:"))).submit(function(){return false});d.append(a('<div><input type="button" class="button" value="Insert" /></div>').click(function(f){var g=a(this).parent("form").find("#email").val();if(g){c.focus();if(!c.getRangeHelper().selectedHtml()){c.wysiwygEditorInsertHtml('<a href="mailto:'+g+'">'+g+"</a>")}else{c.execCommand("createlink","mailto:"+g)}}c.closeDropDown(true);f.preventDefault()}));c.createDropDown(b,"insertemail",d)},tooltip:"Insert an email"},link:{exec:function(b){var c=this,d=a(this._('<form><div><label for="link">{0}</label> <input type="text" id="link" value="http://" /></div><div><label for="des">{1}</label> <input type="text" id="des" value="" /></div></form>',this._("URL:"),this._("Description (optional):"))).submit(function(){return false});d.append(a(this._('<div><input type="button" class="button" value="{0}" /></div>',this._("Insert"))).click(function(g){var h=a(this).parent("form").find("#link").val(),f=a(this).parent("form").find("#des").val();if(h!==""&&h!=="http://"){c.focus();if(!c.getRangeHelper().selectedHtml()||f){if(!f){f=h}c.wysiwygEditorInsertHtml('<a href="'+h+'">'+f+"</a>")}else{c.execCommand("createlink",h)}}c.closeDropDown(true);g.preventDefault()}));c.createDropDown(b,"insertlink",d)},tooltip:"Insert a link"},unlink:{exec:"unlink",tooltip:"Unlink"},quote:{exec:function(c,d,e){var f="<blockquote>",b="</blockquote>";if(d){e=(e?"<cite>"+e+"</cite>":"");f=f+e+d+b+"<br />";b=null}else{if(this.getRangeHelper().selectedHtml()===""){b="<br />"+b}}this.wysiwygEditorInsertHtml(f,b)},tooltip:"Insert a Quote"},emoticon:{exec:function(d){var c,f=this,g=a("<div />"),b=a("<div />");c=function(i,h){b.append(a("<img />").attr({src:h,alt:i}).click(function(k){var l="",j="";if(f.options.emoticonsCompat){l="<span> ";j=" </span>"}f.wysiwygEditorInsertHtml(l+'<img src="'+a(this).attr("src")+'" data-sceditor-emoticon="'+a(this).attr("alt")+'" />'+j);f.closeDropDown(true);k.preventDefault()}));if(b.children().length>3){g.append(b);b=a("<div />")}};a.each(f.options.emoticons.dropdown,c);if(b.children().length>0){g.append(b)}if(typeof f.options.emoticons.more!=="undefined"){var e=a(this._('<a class="sceditor-more">{0}</a>',this._("More"))).click(function(){var h=a.extend({},f.options.emoticons.dropdown,f.options.emoticons.more);g=a("<div />");b=a("<div />");a.each(h,c);if(b.children().length>0){g.append(b)}f.createDropDown(d,"insertemoticon",g)});g.append(e)}f.createDropDown(d,"insertemoticon",g)},keyPress:function(d,f){var c=this,g=0,b=String.fromCharCode(d.which);if(!c.EmoticonsCache){c.EmoticonsCache=[];a.each(a.extend({},c.options.emoticons.more,c.options.emoticons.dropdown,c.options.emoticons.hidden),function(h,e){c.EmoticonsCache[g++]=[h,'<img src="'+e+'" data-sceditor-emoticon="'+h+'" alt="'+h+'" />']});c.EmoticonsCache.sort(function(h,e){return h[0].length-e[0].length})}if(!c.longestEmoticonCode){c.longestEmoticonCode=c.EmoticonsCache[c.EmoticonsCache.length-1][0].length}if(c.getRangeHelper().raplaceKeyword(c.EmoticonsCache,true,true,c.longestEmoticonCode,c.options.emoticonsCompat,b)){if(/^\s$/.test(b)&&c.options.emoticonsCompat){return true}d.preventDefault();d.stopPropagation();return false}},tooltip:"Insert an emoticon"},youtube:{exec:function(b){var c=this;var d=a(this._('<form><div><label for="link">{0}</label> <input type="text" id="link" value="http://" /></div></form>',this._("Video URL:"))).submit(function(){return false});d.append(a(this._('<div><input type="button" class="button" value="{0}" /></div>',this._("Insert"))).click(function(f){var g=a(this).parent("form").find("#link").val();if(g!==""&&g!=="http://"){g=g.replace(/^[^v]+v.(.{11}).*/,"$1");c.wysiwygEditorInsertHtml('<iframe width="560" height="315" src="http://www.youtube.com/embed/'+g+'?wmode=opaque" data-youtube-id="'+g+'" frameborder="0" allowfullscreen></iframe>')}c.closeDropDown(true);f.preventDefault()}));c.createDropDown(b,"insertlink",d)},tooltip:"Insert a YouTube video"},date:{exec:function(){var c=new Date(),d=c.getYear(),e=c.getMonth()+1,b=c.getDate();if(d<2000){d=1900+d}if(e<10){e="0"+e}if(b<10){b="0"+b}this.wysiwygEditorInsertHtml("<span>"+this.options.dateFormat.replace(/year/i,d).replace(/month/i,e).replace(/day/i,b)+"</span>")},tooltip:"Insert current date"},time:{exec:function(){var c=new Date(),b=c.getHours(),e=c.getMinutes(),d=c.getSeconds();if(b<10){b="0"+b}if(e<10){e="0"+e}if(d<10){d="0"+d}this.wysiwygEditorInsertHtml("<span>"+b+":"+e+":"+d+"</span>")},tooltip:"Insert current time"},print:{exec:"print",tooltip:"Print"},source:{exec:function(){this.toggleTextMode()},txtExec:function(){this.toggleTextMode()},tooltip:"View source"},ignore:{}};a.sceditor.rangeHelper=function(e,g){var d,k,c=true,f="sceditor-start-marker",h="sceditor-end-marker",b=this,m,j,i,l;m=function(o,n){k=n||o.contentDocument||o.document;d=o;c=o.getSelection}(e,g);b.insertHTML=function(o,q){var p,n,r;if(q){o+=b.selectedHtml()+q}if(c){r=k.createElement("div");p=k.createDocumentFragment();r.innerHTML=o;while(r.firstChild){p.appendChild(r.firstChild)}b.insertNode(p)}else{b.selectedRange().pasteHTML(o)}};b.insertNode=function(r,n){if(c){var o=k.createDocumentFragment(),p=b.selectedRange(),q,s;o.appendChild(r);if(n){o.appendChild(p.extractContents());o.appendChild(n)}s=o.lastChild;p.deleteContents();p.insertNode(o);q=k.createRange();q.setStartAfter(s);b.selectRange(q)}else{b.insertHTML(r.outerHTML,n?n.outerHTML:null)}};b.cloneSelected=function(){if(!c){return b.selectedRange().duplicate()}return b.selectedRange().cloneRange()};b.selectedRange=function(){var n;if(d.getSelection){n=d.getSelection()}else{n=k.selection}if(n.getRangeAt&&n.rangeCount<=0){n.addRange(k.createRange())}if(!c){return n.createRange()}return n.getRangeAt(0)};b.selectedHtml=function(){var n=b.selectedRange();if(!n){return""}if(e.XMLSerializer){return new XMLSerializer().serializeToString(n.cloneContents())}if(!c){if(n.text===""){return""}if(n.htmlText){return n.htmlText}}return""};b.parentNode=function(){var n=b.selectedRange();if(c){return n.commonAncestorContainer}else{return n.parentElement()}};b.insertNodeAt=function(p,o){var n=b.cloneSelected();n.collapse(p);if(n.insertNode){n.insertNode(o)}else{n.pasteHTML(o.outerHTML)}};j=function(o){b.removeMarker(o);var n=k.createElement("span");n.id=o;n.style.lineHeight="0";n.style.display="none";n.className="sceditor-selection";return n};b.insertMarkers=function(){b.insertNodeAt(true,j(f));b.insertNodeAt(false,j(h))};b.getMarker=function(n){return k.getElementById(n)};b.removeMarker=function(o){var n=b.getMarker(o);if(n){n.parentNode.removeChild(n)}};b.removeMarkers=function(){b.removeMarker(f);b.removeMarker(h)};b.saveRange=function(){b.insertMarkers()};b.selectRange=function(n){if(!c){n.select()}else{d.getSelection().removeAllRanges();d.getSelection().addRange(n)}};b.restoreRange=function(){var p=b.selectedRange(),q=b.getMarker(f),o=b.getMarker(h);if(!q||!o){return false}if(!c){var n=k.body.createTextRange();n.moveToElementText(q);p.setEndPoint("StartToStart",n);p.moveStart("character",0);n.moveToElementText(o);p.setEndPoint("EndToStart",n);p.moveEnd("character",0);b.selectRange(p.select())}else{p=k.createRange();p.setStartBefore(q);p.setEndAfter(o);b.selectRange(p)}b.removeMarkers()};l=function(p,o){var n=b.cloneSelected();n.collapse(false);if(!c){n.moveStart("character",0-p);n.moveEnd("character",o)}else{n.setStart(n.startContainer,n.startOffset-p);n.setEnd(n.endContainer,n.endOffset+o)}b.selectRange(n)};i=function(r,q){var o="",n=b.cloneSelected(),p;n.collapse(false);if(r){if(!c){n.moveStart("character",0-q);o=n.text}else{o=n.startContainer.textContent.substr(0,n.startOffset);o=o.substr(Math.max(0,o.length-q))}}else{if(!c){n.moveEnd("character",q);o=n.text}else{o=n.startContainer.textContent.substr(n.startOffset,q)}}return o};b.raplaceKeyword=function(z,u,y,n,B,r){if(!y){z.sort(function(D,C){return D.length-C.length})}var o=n||z[z.length-1][0].length,A,p,w,t,q,s,v,x;A=p=w="";if(B){if(!c){return false}++o}A=i(true,o);if(u){p=i(false,o)}w=A+(r!=null?r:"")+p;t=z.length;while(t--){v=new RegExp("(?:[\\s\xA0\u2002\u2003\u2009])"+a.sceditor.regexEscape(z[t][0])+"(?=[\\s\xA0\u2002\u2003\u2009])");x=A.length-1-z[t][0].length;if(B){--x}x=Math.max(0,x);if((!B&&(q=w.indexOf(z[t][0],x))>-1)||(B&&(q=w.substr(x).search(v))>-1)){if(B){q+=x+1}if(q>A.length||q+z[t][0].length+(B?1:0)<A.length){continue}s=A.length-q;l(s,z[t][0].length-s-(r!=null&&/^\S/.test(r)?1:0));b.insertHTML(z[t][1]);return true}}return false}};a.sceditor.dom={traverse:function(e,d,b,f,c){if(e){e=c?e.lastChild:e.firstChild;while(e!=null){if(!b&&d(e)===false){return false}if(!f&&this.traverse(e,d,b,f,c)===false){return false}if(b&&d(e)===false){return false}e=c?e.previousSibling:e.nextSibling}}},rTraverse:function(d,c,b,e){this.traverse(d,c,b,e,true)},isInline:function(e,b){if(e==null||e.nodeType!==1){return true}var c=(window.getComputedStyle?window.getComputedStyle(e):e.currentStyle).display;if(b){return c!=="block"}return c==="inline"},copyCSS:function(c,b){b.style.cssText=c.style.cssText},fixNesting:function(c){var d=this,b=function(e){while(d.isInline(e.parentNode)){e=e.parentNode}return e};d.traverse(c,function(g){if(g.nodeType===1&&!d.isInline(g)&&d.isInline(g.parentNode)){var f=b(g),i=f.parentNode,h=d.extractContents(f,g),e=g;d.copyCSS(e,e);i.insertBefore(h,f);i.insertBefore(e,f)}})},findCommonAncestor:function(c,b){return a(c).parents().has(a(b)).first()},removeWhiteSpace:function(b){var c=/[^\S|\u00A0]+/g;this.traverse(b,function(d){if(d.nodeType===3&&a(d).parents("code, pre").length===0){if(!/\S|\u00A0/.test(d.nodeValue)){d.nodeValue=" "}else{if(c.test(d.nodeValue)){d.nodeValue=d.nodeValue.replace(c," ")}}}})},extractContents:function(d,b){var i=this,e=i.findCommonAncestor(d,b),c=e===null?null:e.get(0),h=false,g=false;return(function f(j){var k=d.ownerDocument.createDocumentFragment();i.traverse(j,function(l){if(g||(l===b&&h)){g=true;return false}if(l===d){h=true}var o,m;if(h){if(jQuery.contains(l,b)&&l.nodeType===1){o=f(l);m=l.cloneNode(false);m.appendChild(o);k.appendChild(m)}else{k.appendChild(l)}}else{if(jQuery.contains(l,d)&&l.nodeType===1){o=f(l);m=l.cloneNode(false);m.appendChild(o);k.appendChild(m)}}});return k}(c))}};a.sceditor.commandExists=function(b){return typeof a.sceditor.commands[b]!=="undefined"};a.sceditor.setCommand=function(d,b,e,c){if(!d||!b){return false}if(!a.sceditor.commandExists(d)){a.sceditor.commands[d]={}}a.sceditor.commands[d].exec=b;if(e){a.sceditor.commands[d].tooltip=e}if(c){a.sceditor.commands[d].keyPress=c}return true};a.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|print,source",style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:"en",charset:"utf-8",emoticonsCompat:false,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:true,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,dropDownCss:{"z-index":"auto"}};a.fn.sceditor=function(b){return this.each(function(){(new a.sceditor(this,b))})}})(jQuery);